---
import { Image } from 'astro:assets'
import type { ImageMetadata } from 'astro'
import { cn } from '@/utils'

const {
	class: className,
	href,
	heading,
	subheading,
	imagePath,
	altText
} = Astro.props

// Check if it's a public SVG or an asset image
const isPublicSVG = imagePath.startsWith('/') && imagePath.endsWith('.svg')
let imageSource = null

if (!isPublicSVG) {
	const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/*.{jpeg,jpg,png,gif}')
	if (!images[imagePath])
		throw new Error(`"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`)
	imageSource = images[imagePath]()
}
---

<div
	class={cn(
		className,
		'project-card flex flex-col gap-y-3 rounded-2xl border border-[#57FD6B]/20 bg-[#1A1A1A]/50 backdrop-blur-sm overflow-hidden transition-all hover:border-[#57FD6B]/40 hover:shadow-volt-soft'
	)}
>
	<div class='flex items-start space-x-4 p-6 cursor-pointer' onclick='toggleProjectDetails(this)'>
		{isPublicSVG ? (
			<img
				src={imagePath}
				alt={altText}
				class='h-20 w-20 rounded-lg flex-shrink-0'
				style='object-fit: contain; background: transparent;'
				loading='eager'
			/>
		) : imageSource ? (
			<Image
				src={imageSource}
				alt={altText}
				class='h-20 w-20 rounded-lg object-cover flex-shrink-0'
				loading='eager'
			/>
		) : (
			<div class='h-20 w-20 rounded-lg bg-gray-200 flex-shrink-0 flex items-center justify-center'>
				<span class='text-gray-500 text-xs'>No Image</span>
			</div>
		)}
		<div class='flex-1'>
			<h3 class='text-lg font-semibold text-[#F5F5F5] mb-2'>{heading}</h3>
			<p class='text-[#A0A0A0] text-sm leading-relaxed line-clamp-2'>{subheading}</p>
		</div>
		<div class='text-[#57FD6B] hover:text-[#57FD6B]/80 transition-colors'>
			<svg class='w-5 h-5 transform transition-transform' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
				<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'></path>
			</svg>
		</div>
	</div>
	<div class='hidden project-details px-6 pb-6'>
		<div class='text-[#A0A0A0] text-sm leading-relaxed mb-4 space-y-4'>
			{heading === 'Volt AI' && (
				<>
					<p>Volt AI combines cybersecurity with artificial intelligence to anticipate, detect and neutralize threats in real-time.</p>
					
					<div>
						<h4 class='text-[#F5F5F5] font-medium mb-2'>Main Products:</h4>
						<ul class='space-y-1 ml-4'>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>Volt Brain:</strong> Superpowers for your SIEM with automated detection and response</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>Volt I√ò:</strong> 24/7 virtual hacker that finds vulnerabilities before attackers</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>Volt APT:</strong> Automated internal pentesting that learns and attacks your network</span>
							</li>
						</ul>
					</div>
					
					<p>Protect your business with the power of predictive AI.</p>
				</>
			)}
			{heading === 'Nimhawk Framework' && (
				<>
					<p>Advanced C4 framework written in Nim with reflective .NET execution, direct syscalls and encrypted communication between implants.</p>
					
					<div>
						<h4 class='text-[#F5F5F5] font-medium mb-2'>Key Features:</h4>
						<ul class='space-y-1 ml-4'>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span>Modular and efficient framework for command & control</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span>Reflective .NET execution to evade detection</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span>Direct syscalls for EDR bypass</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span>Encrypted communication between implants</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span>187+ stars on GitHub, 30 forks</span>
							</li>
						</ul>
					</div>
					
					<p>Essential tool for red team operations.</p>
				</>
			)}
			{heading === 'Offensive Crew' && (
				<>
					<p>Autonomous AI-driven system designed to perform end-to-end web application penetration testing.</p>
					
					<div>
						<h4 class='text-[#F5F5F5] font-medium mb-2'>Architecture as a graph of specialized agents:</h4>
						<ul class='space-y-1 ml-4'>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>ü§ñ</span>
								<span>Autonomous offensive reasoning based on context</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>üï∏Ô∏è</span>
								<span>Distributed scraping and attack surface mapping</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>üß†</span>
								<span>Technical and business logic analysis</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚öîÔ∏è</span>
								<span>Automated exploitation chains</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>üìÑ</span>
								<span>Reports and fix suggestions</span>
							</li>
						</ul>
					</div>
					
					<p>Combines the speed of automation with the strategic thinking of human red teamers.</p>
				</>
			)}
			{heading === 'Hackmetrix' && (
				<>
					<p>Cybersecurity platform that helps companies get certified 10 times faster in standards like ISO 27001 and PCI DSS.</p>
					
					<div>
						<h4 class='text-[#F5F5F5] font-medium mb-2'>Main Solutions:</h4>
						<ul class='space-y-1 ml-4'>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>ISO 27001:</strong> Information security certification</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>PCI DSS:</strong> Payment processing compliance</span>
							</li>
							<li class='flex items-start'>
								<span class='text-[#57FD6B] mr-2'>‚Ä¢</span>
								<span><strong>Ethical Hacking:</strong> Professional penetration testing</span>
							</li>
						</ul>
					</div>
					
					<div>
						<p><strong>Clients:</strong> Mercado Libre, Datamart, Buk, Fracttal, Talana, PixelPay</p>
						<p><strong>Recognition:</strong> Forbes, Bloomberg, El Mercurio, Diario Financiero</p>
					</div>
				</>
			)}
		</div>
		<div class='flex justify-end'>
			{heading === 'Offensive Crew' ? (
				<button 
					class='inline-flex items-center px-4 py-2 bg-gray-500/20 text-gray-400 rounded-lg cursor-not-allowed'
					disabled
				>
					<span>Not Available Yet</span>
					<svg class='w-4 h-4 ml-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
						<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z'></path>
					</svg>
				</button>
			) : (
				<a 
					href={href} 
					target='_blank' 
					rel='noopener noreferrer'
					class='inline-flex items-center px-4 py-2 bg-[#57FD6B]/10 hover:bg-[#57FD6B]/20 text-[#57FD6B] rounded-lg transition-colors'
				>
					<span>Visit Project</span>
					<svg class='w-4 h-4 ml-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
						<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14'></path>
					</svg>
				</a>
			)}
		</div>
	</div>
</div>
